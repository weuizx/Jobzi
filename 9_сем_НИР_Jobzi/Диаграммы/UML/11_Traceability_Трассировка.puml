@startuml Traceability
title Диаграмма трассировки: Шаги процесса TO-BE → Требования → Функции

' Таблица трассировки
!pragma layout smetana

|= № |= Шаг процесса (TO-BE, автоматизированные) |= Требования пользователя |= Функции (Use Case) |

| 1 | **2.3-2.4** Установить состояние VACANCY_CREATE_TITLE\nи отправить запрос названия | Система должна вести пошаговый\nдиалог создания вакансии | UC-6: Создать вакансию |

| 2 | **2.6-2.8** Валидировать ввод названия,\nсохранить в ConversationContext,\nзапросить описание | Система должна валидировать\nданные и сохранять промежуточное\nсостояние | UC-6: Создать вакансию\nUC-27: Валидация ввода |

| 3 | **2.10** Запросить локацию\nс возможностью пропустить | Необязательные поля должны\nпропускаться | UC-6: Создать вакансию |

| 4 | **2.12** Запросить зарплату\nс возможностью пропустить | Необязательные поля должны\nпропускаться | UC-6: Создать вакансию |

| 5 | **2.14-2.15** Сформировать\nи показать предпросмотр вакансии | Работодатель должен видеть\nпредпросмотр перед публикацией | UC-6: Создать вакансию |

| 6 | **2.17-2.18** Вызвать VacancyDbService,\nсгенерировать уникальный код ABC123 | Каждая вакансия должна иметь\nуникальный читаемый код | UC-6: Создать вакансию\nUC-25: Генерация\nуникального кода |

| 7 | **2.19** Создать запись в БД\n(vacancy_id, code, title, etc.) | Данные вакансии должны\nсохраняться структурированно | UC-6: Создать вакансию |

| 8 | **2.20** Отправить сообщение\n"Вакансия создана! Код: ABC123" | Работодатель должен получить\nподтверждение и код | UC-6: Создать вакансию |

| 9 | **6.4** Валидировать формат кода\nvacancy [A-Z]{3}\\d{3} | Система должна проверять\nкорректность кода | UC-22: Откликнуться\nпо коду\nUC-27: Валидация ввода |

| 10 | **6.5** Проверить существование\nвакансии в БД (SELECT WHERE code\nAND status = ACTIVE) | Отклик возможен только\nна активные вакансии | UC-22: Откликнуться\nпо коду |

| 11 | **6.6** Проверить дубли откликов\n(SELECT WHERE vacancy_id\nAND user_id) | Соискатель не может\nоткликнуться повторно | UC-22: Откликнуться\nпо коду |

| 12 | **6.7-6.8** Показать детали вакансии\nи кнопки [Откликнуться] [Отмена] | Соискатель должен видеть\nполную информацию о вакансии | UC-22: Откликнуться\nпо коду |

| 13 | **7.1** Создать отклик в БД\n(INSERT applications,\nstatus='NEW') | Отклик сохраняется сразу\nперед началом анкетирования | UC-22: Откликнуться\nпо коду |

| 14 | **7.2-7.3** Загрузить вопросы\nиз БД и установить состояние\nAPPLICATION_QUESTION | Система должна получить\nкастомные вопросы вакансии | UC-23: Заполнить анкету\nUC-11: Выбрать\nстандартную анкету |

| 15 | **7.4** Показать вопрос с прогрессом\n"{N}/{M}: {question_text}"\n[Прогресс: ▓▓▓░░░░░] | Соискатель должен видеть\nпрогресс заполнения анкеты | UC-23: Заполнить анкету |

| 16 | **7.6** Валидировать ответ\nпо типу (PHONE, NUMBER, DATE) | Система должна проверять\nформат ответов | UC-23: Заполнить анкету\nUC-27: Валидация ввода |

| 17 | **7.7** Сохранить ответ в БД\nсо snapshot контекста\n(question_text, question_type,\nquestion_order) | Ответы должны сохраняться\nс копией вопроса для защиты\nот изменений | UC-23: Заполнить анкету\nUC-26: Snapshot\nконтекста ответов |

| 18 | **7.8** Отправить сообщение\n"Отклик успешно отправлен!" | Соискатель должен получить\nподтверждение отправки | UC-23: Заполнить анкету |

| 19 | **7.9** Отправить уведомление\nработодателю с ключевыми данными | Работодатель должен\nполучать уведомления\nо новых откликах | UC-15: Просмотр откликов |

legend right
  **Легенда:**
  • Шаг процесса - автоматизированные
    шаги из Activity диаграмм TO-BE
    (выделены зеленым цветом)
  • Требования пользователя - описание
    ожидаемого поведения системы
  • Функции - Use Case из диаграммы
    вариантов использования

  **Статистика трассировки:**
  • Автоматизированных шагов: 19
  • Требований: 19
  • Функций Use Case: 8 (UC-6, UC-11,
    UC-15, UC-22, UC-23, UC-25, UC-26, UC-27)
  • Покрытие: 100%

  **Ключевые функции:**
  • UC-25: Генерация уникального кода
  • UC-26: Snapshot контекста ответов
  • UC-27: Валидация ввода
end legend

@enduml
